<!DOCTYPE html>

<html>

	<head>
		<title>ivillega | HW 4</title>

		<style>
			.title_text{
				font-size: 60px;
			}
			.navigation_text{
				color: gray;
			}
			.italicize_text{
				font-style: italic;
			}
			.bold_text{
				font-weight: bold;
			}
			.center_text{
				text-align: center;
			}

			.title_container{
				margin: 15px;
				font-size: 20px;
			}
			.submission_container{
				margin: 15px;
			}
			.button_container{
				margin: 15px;
			}
		</style>

		<script type="text/javascript">

			// All operations under one function for efficiency
			function viewJSON(testing){
				var URL = testing.URL.value;

				// loadJSON using example from class
				var jsonDoc;
				function loadJSON(given) {
					var xmlreq = new XMLHttpRequest();
					xmlreq.open("GET", given, false);
					xmlreq.send();
					jsonDoc = JSON.parse(xmlreq.responseText);
					return jsonDoc;
				}

				// Gets JSON information and outputs to HTML
				function generateHTML(jObj){
					root = jObj.Mainline;

					html_text = "<html><head><title>Largest Manufacturers by Production (2017)</title></head><body>";
					html_text += "<table border='2'>";

					// Create Header for table
					html_text += "<thead>";
					header = root.Table.Header;
					var header_order = []  // Keep the order consistent
					for(i = 0; i < header.Data.length; i++){
						html_text += "<th>";
						html_text += header.Data[i];
						header_order.push(header.Data[i])
						html_text += "</th>";
					}
					html_text += "</thead>";

					// Create Body for table
					html_text += "<tbody>";
					entries = root.Table.Row;
					if(!root.Table.hasOwnProperty("Row") || root.Table.Row.length == 0){  // Check if Row exists or if it has content
						return "No Rows";
					}

					var orig_html = html_text;

					for(j = 0; j < entries.length; j++){  					// Start Row

						all_entries = "";
						line_check = 0;

						for(k = 0; k < header_order.length; k++){  			// Start Column
							new_entries = "<td>";
							
							if(k == 2){  									// Dotted list
								new_entries += "<ul>"
								cc_info = entries[j]["Hubs"]["Hub"];
								for(i = 0; i < cc_info.length; i++){
									new_entries += "<li>";
									if(i == 0){
										new_entries += "<b>";
									}
									if(cc_info[i].trim() != ""){
										line_check += 1;
									}
									new_entries += cc_info[i];
									if(i == 0){
										new_entries += "</b>";
									}
									new_entries += "</li>";
								}
								new_entries += "</ul>";
							}
							else if(k == 3){  								// Height
								if(entries[j]["Height"].trim() != ""){
									line_check += 1;
								}
								new_entries += entries[j]["Height"];
							}
							else if(k == 4){  								// Wiki page given
								if(entries[j]["HomePage"].trim() != ""){
									line_check += 1;
								}
								new_entries += entries[j]["HomePage"];
							}
							else if(k == 5){  								// Image
								if(entries[j]["Logo"].trim() != ""){
									line_check += 1;
								}
								new_entries += '<img src="' + entries[j]["Logo"] + '" style="width:130px;height:130px;">';
							}
							else{  											// Anything else
								if(entries[j][header_order[k]].trim() != ""){
									line_check += 1;
								}
								new_entries += entries[j][header_order[k]];
							}

							new_entries += "</td>";  						// End column

							if(line_check > 0){  							// If something exists in row, accept
								all_entries += new_entries;
							}
						}

						if(all_entries != ""){  		// End Row && check if row exists with data
							html_text += "<tr>";
							html_text += all_entries;
							html_text += "</tr>";
						}
					}

					if(orig_html == html_text){
						return "No Rows";
					}

					html_text += "</bo";  // Closing Body tag is separated because of freevar interpreter
					html_text += "dy>";
					html_text += "</html>";
					return html_text;
				}

				try{
					jsonObj = loadJSON(URL);
				}
				catch(Error){  								// Check for error loading JSON file
					alert("Error: problem loading your JSON file. Make sure you spelled your file correctly (or that it exists).")
					return -1;
				}

				jsonObj = loadJSON(URL);
				jsonObj.onload = generateHTML(jsonObj);
				
				if(jsonObj.onload == "No Rows"){  			// Check error of no row
					alert("Error: No rows present");
				}
				else{  										// All went with no errors
					hWin = window.open("", "Assignment4", "height=800,width=1200");
					hWin.document.write(html_text);
					hWin.document.close();
				}
			}

		</script>

	</head>

	<body>
		<div class="bold_text center_text title_container">
			Enter URL for list of tallest buildings JSON File
		</div>
		<form name="myform" method="POST" id="location">
		<div class="center_text submission_container">
			<input rows="1" type="text" name="URL" id="building_json" placeholder="JSON file for buildings">
		</div>
		<div class="center_text button_container">
			<input type="button" name="submit_json" id="submit" value="Submit Query" onClick="viewJSON(this.form)"/>
		</div>
	</body>

</html>